{% extends 'AKPlan/base.html' %}
{% block toolbar %}
    <style>
        .toolbar label {
            padding-right: 10px;
        }

        #content > br {
            display: none
        }
    </style>
<!--
    <input type="radio" name="modus" id="mode_slots"><label for="mode_slots"> Slots</label>
    <input type="radio" name="modus" id="mode_availability"><label for="mode_availability"> Verf√ºgbarkeit</label>
    <input type="radio" name="modus" id="mode_aktermin"><label for="mode_aktermin"> AKs / Termine</label>
    <input type="radio" name="modus" id="mode_akreadonly"><label for="mode_akreadonly"> AKs readonly</label>
-->
{% endblock %}


{% block content %}
    <div id="akplan">

        {% if beamer %}
            <div class="beamer"> {% endif %}
        <div id="unsched_aktermine"></div>
        <div class="calendar_content">
            <div id='calendar'></div>
        </div>
        {% if beamer %} </div> {% endif %}

    </div>

    <script>


        $("[name=modus]").click(function () {
            setMode($(this).attr("id").substr(5));
        });

        function setMode(mode) {
            akplan.mode = mode;
            localStorage.calendarMode = mode;
            $("#mode_" + mode).attr("checked", true);
            $("#calendar").fullCalendar('refetchEvents');
            $("#akplan").attr("class", "mode_" + mode);
            if (mode == "aktermin") {
                akplan.api.loadUnschedAkTermine();
            }

        }

        $(document).ready(function () {

            // page is now ready, initialize the calendar...

            $('#calendar').fullCalendar(calendarDefaultOptions({
                defaultView: localStorage.calendarAkView ? localStorage.calendarAkView : 'timelineDay',
                header: {
                    left: 'timelineWeek,agendaDay,timelineDay',
                    center: 'title',
                    right: 'today prev,next'
                },

                eventDrop: akplan.api.onCalendarEventChange,
                eventResize: akplan.api.onCalendarEventChange,
                eventReceive: akplan.api.saveAkTermin,

                select: function (start, end, jsEvent, view, resource) {
                    akplan.api.createRoomAvailability(start, end, resource.id);
                },

                height: window.innerHeight - $('#calendar').offset().top - 10,
                resourceAreaWidth: 120,

                viewRender: function (view, el) {
                    localStorage.calendarDate = view.start.toISOString();
                    localStorage.calendarAkView = view.name;
                },
                resources: function (callback) {
                    $.get("/kif475/plan/api/room/", function (rooms) {
                        callback(rooms.map(function (x) {
                            var room_name = x.name;
                            if(x.building != '')
                                room_name = x.building + " " + room_name;
                            return {id: x.id, title: room_name };
                        }));
                    });
                },
                events: function (start, end, timezone, callback) {
                    akplan.api.loadCalendarEvents(start, end, undefined, callback);
                },

                eventRender: function (event, element) {
                    element.bind('contextmenu', function (jsEvent) {
                        var menu = getEventContextMenu(event, jsEvent);

                        ShowContextMenu(jsEvent, menu);
                        return false;
                    });
                }


            }));


            setMode(localStorage.calendarMode ? localStorage.calendarMode : "akreadonly");

        });
    </script>

{% endblock %}

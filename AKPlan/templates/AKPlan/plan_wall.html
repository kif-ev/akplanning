{% load static %}
{% load i18n %}
{% load bootstrap4 %}
{% load fontawesome_5 %}
{% load tags_AKModel %}
{% load tz %}


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}AK Planning{% endblock %}</title>

    {# Load Bootstrap CSS and JavaScript as well as font awesome #}
    {% bootstrap_css %}
    {% bootstrap_javascript jquery='slim' %}
    {% fontawesome_5_static %}

    <link rel="stylesheet" href="{% static 'common/css/custom.css' %}">

    {% get_current_language as LANGUAGE_CODE %}

    <link href='{% static 'AKPlan/vendor/fullcalendar/core/main.css' %}' rel='stylesheet'/>
    <link href='{% static 'AKPlan/vendor/fullcalendar/timeline/main.css' %}' rel='stylesheet'/>
    <link href='{% static 'AKPlan/vendor/fullcalendar/resource-timeline/main.css' %}' rel='stylesheet'/>
    <link href='{% static 'AKPlan/vendor/fullcalendar/resource-timeline/main.min.css' %}' rel='stylesheet'/>

    <script src='{% static 'AKPlan/vendor/fullcalendar/core/main.js' %}'></script>
    {% with 'AKPlan/vendor/fullcalendar/core/locales/'|add:LANGUAGE_CODE|add:'.js' as locale_file %}
        <script src="{% static locale_file %}"></script>
    {% endwith %}
    <script src='{% static 'AKPlan/vendor/fullcalendar/timeline/main.js' %}'></script>
    <script src='{% static 'AKPlan/vendor/fullcalendar/resource-common/main.js' %}'></script>
    <script src='{% static 'AKPlan/vendor/fullcalendar/resource-timeline/main.js' %}'></script>
    <script src='{% static 'AKPlan/vendor/fullcalendar/bootstrap/main.js' %}'></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var planEl = document.getElementById('planCalendar');

            var plan = new FullCalendar.Calendar(planEl, {
                plugins: ['resourceTimeline', 'bootstrap'],
                timeZone: '{{ event.timezone }}',
                header: false,
                themeSystem: 'bootstrap',
                // Adapt to user selected locale
                locale: '{{ LANGUAGE_CODE }}',
                type: 'resourceTimeline',
                slotDuration: '01:00',
                defaultView: 'resourceTimeline',
                visibleRange: {
                    start: '{{ start | timezone:event.timezone | date:"Y-m-d H:i:s" }}',
                    end: '{{ end | timezone:event.timezone  | date:"Y-m-d H:i:s"}}',
                },
                scrollTime: '{{ start | timezone:event.timezone | date:"H:i:s" }}',
                editable: false,
                allDaySlot: false,
                nowIndicator: true,
                eventTextColor: '#fff',
                eventColor: '#127ba3',
                height: 'parent',
                resourceAreaWidth: '15%',
                resourceLabelText: '{% trans "Room" %}',
                resources: [
                    {% for room in rooms %}
                        {
                            'id': '{{ room.title }}',
                            'title': '{{ room.title }}'
                        },
                    {% endfor %}
                ],
                events: {% with akslots as slots %}{% include "AKPlan/encode_events.html" %}{% endwith %},
                schedulerLicenseKey: 'GPL-My-Project-Is-Open-Source',
            });

            plan.render();
        });
    </script>

</head>
<body>
{% timezone event.timezone %}
    <div class="row" style="height:100vh;margin:0;padding:1vh;">
        <div class="col-md-3">
            <h1>Plan: {{ event }}</h1>

            <h2><a name="currentAKs">{% trans "Current AKs" %}:</a></h2>
            {% with akslots_now as slots %}
                {% include "AKPlan/slots_table.html" %}
            {% endwith %}

            <h2><a name="currentAKs">{% trans "Next AKs" %}:</a></h2>
            {% with akslots_next as slots %}
                {% include "AKPlan/slots_table.html" %}
            {% endwith %}
        </div>
        <div class="col-md-9" style="height:98vh;">
            <div id="planCalendar"></div>
        </div>
    </div>
{% endtimezone %}

</body>
</html>
